<!DOCTYPE html>
<html translate="no">

<!--
Note for myself on how to add new versions:
- Duplicate this file
- Replace all version string with new version string
- Change const selectedVersion
- Add patch files to the correct directory
- In more-extra-js.js: Add new version
- Update index.html (default redirect) and changelog
-->

<head>
	<title>DX ROM Patcher</title>
	<meta http-equiv="content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0.1, maximum-scale=1.0.1, user-scalable=0" />

	<script>
  		const VERSION_TAG = "3.0.2"; // single global version constant
	</script>

	<script>
	function dxPing() {
		const COUNTER_URL   = "https://script.google.com/macros/s/AKfycbyHxZg6S1er9xYqhf07cTvE497IfDhjeaT2HrBrbm3Rno_3kwkBnn8b3FsIZH-LGds/exec";
		const COUNTER_TOKEN = "8181211210";

		const params = new URLSearchParams({
			authuser: "0",
			hit: "1",
			ver: VERSION_TAG,
			token: COUNTER_TOKEN,
			t: String(Date.now())
		});

		const url = `${COUNTER_URL}?${params.toString()}`;
		console.log("[DX] ping ->", url);

		try {
			fetch(url, { mode: "no-cors", cache: "no-store", credentials: "omit", keepalive: true });
		} catch {}

		const img = document.createElement("img");
		img.src = url + "&_i=1";
		img.alt = "";
		img.width = 1;
		img.height = 1;
		img.style.cssText = "position:absolute;left:-9999px;top:-9999px;width:1px;height:1px";
		img.onload = img.onerror = () => setTimeout(() => img.remove(), 4000);
		document.body.appendChild(img);
	}
	</script>

	<script>
	(function () {
		const COUNT_KEY = "dx_counted_" + VERSION_TAG;

		function maybeCount(e) {
			const btn = e.target && e.target.closest('#rom-patcher-button-apply');
			if (!btn) return;
			if (btn.disabled) return;
			if (sessionStorage.getItem(COUNT_KEY)) return;

			dxPing();
			sessionStorage.setItem(COUNT_KEY, "1");
		}

		document.addEventListener('click', maybeCount, true);
		})();
	</script>

	<!-- Rom Patcher JS needed CSS/JS files -->
	<link type="text/css" rel="stylesheet" href="./rom-patcher-js/style.css" media="all" />
	<script type="text/javascript" src="./rom-patcher-js/RomPatcher.webapp.js"></script>

	<!-- Rom Patcher JS initialization -->
	<script type="text/javascript">
	window.addEventListener('load', function(){
		const myPatcherSettings={
			language: 'en',
			requireValidation: false, /* if true, user won't be able to apply patch if the provided ROM is not valid*/
			allowDropFiles: true /* if true, it adds basic drag and drop support */
		};
		RomPatcherWeb.initialize(myPatcherSettings, {
			file: './DXPatch/DX_3_0_2.zip', //zip containing patches
			patches: [ //information about patches inside the zip
				{
					file: 'DX_3_0_2.xdelta', //zip containing patches
					name: 'DX 3.0.2 Release',
					outputName: "Pokemon XD - DX [Director's Cut] v3.0.2", //patched ROM name
				}
			]
		});
		RomPatcherWeb.pickEmbededFile("DX_3_0_2.xdelta");
	});
	const selectedVersion = 3;
	</script>
</head>

<body style="font: 15px 'Open Sans', sans-serif; background-color: #080808; color: #e4e4e6; padding-top: 20px;">
<div>

	<!-- Rom Patcher JS container -->
	<!--
		The following elements are required for Rom Patcher JS to work:
			#rom-patcher-input-file-rom
			#rom-patcher-select-patch
			#rom-patcher-button-apply
		The rest of elements are informative and can be removed, though it's recommended to keep them for a better user experience.
	-->

	<center><div style="text-align: left; max-width: 800px;">
		<h1 style="color: #b688ba">DX ROM Patcher</h1>
	<div id="rom-patcher-container" style="background-color: #e7b5ec;">

		<div class="rom-patcher-row margin-bottom" id="versionSelectDiv">
			<div class="text-right"><label for="versionSelectDiv">DX Version:</label>
			</div>
			<div class="rom-patcher-container-input">
				<select id="versionSelect" onchange="changeVersion()"></select>
			</div>
		</div>
		<div class="rom-patcher-row margin-bottom" id="rom-patcher-row-file-rom">
			<div class="text-right"><label for="rom-patcher-input-file-rom" data-localize="yes">Pokemon XD - Gale of Darkness (USA) ROM:</label></div>
			<div class="rom-patcher-container-input">
				<input type="file" id="rom-patcher-input-file-rom" class="empty" disabled />
			</div>
		</div>
		<div class="margin-bottom text-selectable text-mono" id="rom-patcher-rom-info">
			<div class="rom-patcher-row">
				<div class="text-right">CRC32:</div>
				<div class="text-truncate"><span id="rom-patcher-span-crc32"></span></div>
			</div>
			<div class="rom-patcher-row">
				<div class="text-right">MD5:</div>
				<div class="text-truncate"><span id="rom-patcher-span-md5"></span></div>
			</div>
			<div class="rom-patcher-row">
				<div class="text-right">SHA-1:</div>
				<div class="text-truncate"><span id="rom-patcher-span-sha1"></span></div>
			</div>
			<div class="rom-patcher-row" id="rom-patcher-row-info-rom">
				<div class="text-right">ROM:</div>
				<div class="text-truncate"><span id="rom-patcher-span-rom-info"></span></div>
			<div class="rom-patcher-container-input">
				<select id="rom-patcher-select-patch"></select>
			</div>
		</div>
		<div class="rom-patcher-row margin-bottom" id="rom-patcher-row-patch-description">
			<div class="text-right text-mono text-muted" data-localize="yes">Description:</div>
			<div class="text-truncate" id="rom-patcher-patch-description"></div>
		</div>
		<div class="rom-patcher-row margin-bottom text-selectable text-mono text-muted"
			id="rom-patcher-row-patch-requirements">
			<div class="text-right text-mono" id="rom-patcher-patch-requirements-type">ROM requirements:</div>
			<div class="text-truncate" id="rom-patcher-patch-requirements-value"></div>
		</div>

		<div class="text-center" id="rom-patcher-row-apply">
			<div id="rom-patcher-row-error-message" class="margin-bottom"><span id="rom-patcher-error-message"></span>
			</div>
			<button id="rom-patcher-button-apply" data-localize="yes" style="background-color: #6c1175" disabled>Apply patch</button>
		</div>
	</div>
	<div id="rom-patcher-container" style="background-color: #080808;">
		<center>
			<a href="./changelog"><button style="background-color: #d58bdb">Changelog</button></a>
			<a href="https://github.com/PepGames/DX_DirectorsCut"><button style="background-color: #6c1175">About (Github)</button></a>
		</center>
	</div>
		<p style="text-align: center;">
			You will need to provide your own LEGAL copy of Pokemon XD - Gale of Darkness (USA), select it as the "Pokemon XD - Gale of Darkness (USA) ROM".
		</p>
		<p style="text-align: center;">
			This project does not provide copyrighted game files. You must legally obtain them yourself. For the patcher to work, the ROM must be called "Pokemon XD - Gale of Darkness (USA).iso" exactly.
		</p>
		<p style="text-align: center;">
			Any other file types such as ".ciso", ".rvz", ".nkit", or others are incompatible with this patch and will fail.
		</p>
	</div></center>

	<div id="rom-patcher-powered" class="text-center">
		<a href="https://github.com/marcrobledo/RomPatcher.js" target="_blank"><img
				src="rom-patcher-js/assets/powered_by_rom_patcher_js.png" loading="lazy" />Powered by Rom Patcher JS</a>
	</div>
</div>
	<script type="text/javascript" src="./rom-patcher-js/more-extra-js.js"></script>
</body>

</html>